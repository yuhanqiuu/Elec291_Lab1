                  2   $LIST
0000              4   
0000              5   ;  N76E003 pinout:
0000              6   ;                               -------
0000              7   ;       PWM2/IC6/T0/AIN4/P0.5 -|1    20|- P0.4/AIN5/STADC/PWM3/IC3
0000              8   ;               TXD/AIN3/P0.6 -|2    19|- P0.3/PWM5/IC5/AIN6
0000              9   ;               RXD/AIN2/P0.7 -|3    18|- P0.2/ICPCK/OCDCK/RXD_1/[SCL]
0000             10   ;                    RST/P2.0 -|4    17|- P0.1/PWM4/IC4/MISO
0000             11   ;        INT0/OSCIN/AIN1/P3.0 -|5    16|- P0.0/PWM3/IC3/MOSI/T1
0000             12   ;              INT1/AIN0/P1.7 -|6    15|- P1.0/PWM2/IC2/SPCLK
0000             13   ;                         GND -|7    14|- P1.1/PWM1/IC1/AIN7/CLO
0000             14   ;[SDA]/TXD_1/ICPDA/OCDDA/P1.6 -|8    13|- P1.2/PWM0/IC0
0000             15   ;                         VDD -|9    12|- P1.3/SCL/[STADC]
0000             16   ;            PWM5/IC7/SS/P1.5 -|10   11|- P1.4/SDA/FB/PWM1
0000             17   ;                               -------
0000             18   ;
0000             19   
0000             20   CLK           EQU 16600000 ; Microcontroller system frequency in Hz
0000             21   TIMER0_RATE   EQU 4096     ; 2048Hz squarewave (peak amplitude of CEM-1203 speaker)
0000             22   TIMER0_RELOAD EQU ((65536-(CLK/TIMER0_RATE)))
0000             23   BAUD              EQU 115200 ; Baud rate of UART in bps
0000             24   TIMER1_RELOAD     EQU (0x100-(CLK/(16*BAUD)))
0000             25   TIMER0_RELOAD_1MS EQU (0x10000-(CLK/1000))
0000             26   TIMER2_RATE   EQU 1000     ; 1000Hz, for a timer tick of 1ms
0000             27   TIMER2_RELOAD EQU ((65536-(CLK/TIMER2_RATE)))
0000             28   
0000             29   ;---------------------------------;
0000             30   ; Define any buttons & pins here  ;
0000             31   ;---------------------------------;
0000             32   SOUND_OUT   equ p1.7 ; speaker pin
0000             33   PWM_OUT    EQU P1.0 ; Logic 1=oven on
0000             34   ;---------------------------------------------
0000             35   ORG 0x0000
0000 020579      36            ljmp main
0003             37   
0003             38   ;---------------------------------;
0003             39   ; Define any constant string here ;
0003             40   ;---------------------------------;
0003             41   ;                          1234567890123456    <- This helps determine the location of the counter
0003 546F3D78    42   To_Message:        db 'To=xxxC Tj= 22C ', 0
     78784320
     546A3D20
     32324320
     00
0014 73787878    43   Time_temp_display:db 'sxxx,xx rxxx,xx ', 0 ; soak temp,time reflow temp,time
     2C787820
     72787878
     2C787820
     00
0025 52616D70    44   Ramp_to_soak:      db 'RampToSoak s=xxx', 0 ; state 1 display
     546F536F
     616B2073
     3D787878
     00
0036 536F616B    45   Soak_display:      db 'Soak               s=xxx', 0 ; state 2 display
     20090920
     733D7878
     7800
0044 52616D70    46   Ramp_to_peak:      db 'RampToPeak s=xxx', 0 ; state 3 display
     546F5065
     616B2073
     3D787878
     00
0055 5265666C    47   Reflow_display:   db 'Reflow      s=xxx', 0 ; state 4 display
     6F772009
     20733D78
     787800
0064 436F6F6C    48   Cooling_display:  db 'Cooling     s=xxx', 0 ; state 5 display
     696E6720
     0920733D
     78787800
0074             49   ;---------------------------------------------
0074             50   
0074             51   
0074             52   cseg
0074             53   LCD_RS equ P1.3
0074             54   LCD_E  equ P1.4
0074             55   LCD_D4 equ P0.0
0074             56   LCD_D5 equ P0.1
0074             57   LCD_D6 equ P0.2
0074             58   LCD_D7 equ P0.3
0074             59   
                 61   $LIST
0146             63   
0146             64   ;---------------------------------;
0146             65   ; Define variables here           ;
0146             66   ;---------------------------------;
0146             67   ; These register definitions needed by 'math32.inc'
0030             68   DSEG at 30H
0030             69   x:   ds 4
0034             70   y:   ds 4
0038             71   bcd: ds 5   ;temperature variable for reading
003D             72   Count1ms:     ds 2 ; Used to determine when one second has passed
003F             73   seconds: ds 1
0040             74   VLED_ADC: ds 2
0042             75   reflow_time: ds 1 ; time parameter for reflow    
0043             76   reflow_temp: ds 1 ; temp parameter for reflow
0044             77   soak_time: ds 1 ; time parameter for soak
0045             78   soak_temp: ds 1 ; temp parameter for soak
0046             79   pwm_counter: ds 1 ; power counter
0047             80   pwm: ds 1 ; variable to count the power percentage
0048             81   temp: ds 3
004B             82   FSM_state: ds 1
004C             83   ;---------------------------------------------
004C             84   
004C             85   ;---------------------------------;
004C             86   ; Define flags here               ;
004C             87   ;---------------------------------;
0000             88   BSEG
0000             89   mf: dbit 1
0001             90   s_flag: dbit 1 ; Set to one in the ISR every time 1000 ms had passed
0002             91   PB0: dbit 1      ; start/stop
0003             92   PB1: dbit 1      ; increment reflow time
0004             93   PB2: dbit 1      ; increment reflow temp
0005             94   PB3: dbit 1      ; increment soak time
0006             95   PB4: dbit 1      ; increment soak temp
0007             96   start_stop_flag: dbit 1 ; Set to one if button is pressed to start, press again to stop
0008             97   ;---------------------------------------------
0008             98   
                546   $LIST
